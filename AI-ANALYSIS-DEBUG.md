# AI åˆ†æå¤±æ•—è¨ºæ–·æŒ‡å—

## ğŸš€ å¿«é€Ÿè¨ºæ–·æ­¥é©Ÿ

### 1. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
```bash
npm run dev
```

### 2. é‹è¡Œè¨ºæ–·å·¥å…·
åœ¨å¦ä¸€å€‹çµ‚ç«¯é‹è¡Œï¼š
```bash
node debug-analysis.js
```

é€™å€‹å·¥å…·æœƒè‡ªå‹•æª¢æŸ¥ï¼š
- âœ… Supabase è³‡æ–™åº«é€£æ¥
- âœ… å°è©±æ•¸æ“šæ˜¯å¦å­˜åœ¨
- âœ… API ç«¯é»æ˜¯å¦æ­£å¸¸
- âœ… å·²åˆ†æçš„è³‡æ–™

### 3. åœ¨ç€è¦½å™¨æ¸¬è©¦
1. æ‰“é–‹ http://localhost:3000/analyze
2. é»æ“Šã€Œé–‹å§‹ AI åˆ†æã€
3. æ‰“é–‹ç€è¦½å™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è©³ç´°æ—¥èªŒ

---

## ğŸ” å·²ä¿®å¾©çš„å•é¡Œ

### 1. UUID ç”Ÿæˆå•é¡Œ
**å•é¡Œ**: ä½¿ç”¨ `require('crypto')` å°è‡´ Next.js é‹è¡Œæ™‚éŒ¯èª¤
**ä¿®å¾©**: æ”¹ç”¨ ES6 `import { randomUUID } from 'crypto'`

### 2. å‰ç«¯éŒ¯èª¤è™•ç†
**å•é¡Œ**: æª¢æŸ¥ `json.ok` è€Œä¸æ˜¯ `json.success`
**ä¿®å¾©**: æ”¹ç‚ºæª¢æŸ¥ `json.success`ï¼Œä¸¦å¢å¼·éŒ¯èª¤æ—¥èªŒ

### 3. éŒ¯èª¤è¨Šæ¯ä¸æ¸…æ¥š
**å•é¡Œ**: JSON è§£æå¤±æ•—æ™‚ç„¡æ³•çœ‹åˆ°è©³ç´°éŒ¯èª¤
**ä¿®å¾©**: å¢åŠ  content-type æª¢æŸ¥å’Œè©³ç´°çš„éŒ¯èª¤æ—¥èªŒ

---

## ğŸ“Š æŸ¥çœ‹æ—¥èªŒä½ç½®

### å‰ç«¯æ—¥èªŒï¼ˆç€è¦½å™¨æ§åˆ¶å°ï¼‰
æŒ‰ F12 æ‰“é–‹é–‹ç™¼è€…å·¥å…·ï¼ŒæŸ¥çœ‹ï¼š
- `å›æ‡‰ç‹€æ…‹: ...`
- `å›æ‡‰é¡å‹: ...`
- `åˆ†æ API å›æ‡‰: ...`

### å¾Œç«¯æ—¥èªŒï¼ˆçµ‚ç«¯ï¼‰
åœ¨é‹è¡Œ `npm run dev` çš„çµ‚ç«¯æŸ¥çœ‹ï¼š
- `Starting analysis...`
- `Found X conversations`
- `Processing X messages`
- `æº–å‚™å¯«å…¥ X ç­†è³‡æ–™...`

---

## âŒ å¸¸è¦‹éŒ¯èª¤åŠè§£æ±ºæ–¹æ¡ˆ

### éŒ¯èª¤ 1: "Internal Server Error"
**åŸå› **: API è·¯ç”±ç™¼ç”Ÿæœªæ•ç²çš„éŒ¯èª¤
**è§£æ±º**: æŸ¥çœ‹å¾Œç«¯çµ‚ç«¯çš„è©³ç´°éŒ¯èª¤è¨Šæ¯

### éŒ¯èª¤ 2: "invalid input syntax for type uuid"
**åŸå› **: conversation_id ä¸æ˜¯æœ‰æ•ˆçš„ UUID æ ¼å¼
**è§£æ±º**: å·²ä¿®å¾© `generateId()` å‡½æ•¸

### éŒ¯èª¤ 3: "No response" æˆ– "Gemini API request failed"
**åŸå› **: Gemini API é…é¡ç”¨å®Œæˆ–ç¶²è·¯å•é¡Œ
**è§£æ±º**:
1. æª¢æŸ¥ API Key æ˜¯å¦æœ‰æ•ˆ
2. æª¢æŸ¥ç¶²è·¯é€£ç·š
3. ç­‰å¾…é…é¡é‡ç½®ï¼ˆå…è²»ç‰ˆæ¯å¤©é™åˆ¶ï¼‰

### éŒ¯èª¤ 4: "æœªç™¼ç¾æœ‰æ•ˆçš„æ•¸å­¸æ¦‚å¿µ"
**åŸå› **: AI åˆ†æçµæœä¸­æ²’æœ‰è­˜åˆ¥åˆ°æ•¸å­¸æ¦‚å¿µ
**è§£æ±º**: é€™æ˜¯æ­£å¸¸çš„ï¼Œç³»çµ±æœƒè‡ªå‹•è·³ééæ•¸å­¸ç›¸é—œçš„å°è©±

---

## ğŸ›  æ‰‹å‹•æ¸¬è©¦ API

å¦‚æœè¨ºæ–·å·¥å…·ç„¡æ³•é‹è¡Œï¼Œå¯ä»¥æ‰‹å‹•æ¸¬è©¦ï¼š

```bash
# æ¸¬è©¦ API ç«¯é»
curl -X POST http://localhost:3000/api/analyze-results/analyze \
  -H "Content-Type: application/json"
```

é æœŸå›æ‡‰ï¼š
```json
{
  "success": true,
  "data": {
    "count": 3,
    "message": "æˆåŠŸåˆ†æ 3 ç­†è¨Šæ¯"
  },
  "meta": {
    "timestamp": "2025-11-24T08:00:00.000Z"
  }
}
```

---

## ğŸ“ æª¢æŸ¥è³‡æ–™è¡¨çµæ§‹

å¦‚æœæŒçºŒå‡ºç¾è³‡æ–™åº«éŒ¯èª¤ï¼Œæª¢æŸ¥ Supabase `analyzed_attempts` è¡¨æ˜¯å¦æœ‰ä»¥ä¸‹æ¬„ä½ï¼š

å¿…è¦æ¬„ä½ï¼š
- `id` (uuid, primary key)
- `user_id` (uuid)
- `conversation_id` (uuid)
- `message_index` (integer)
- `text` (text)
- `concepts_used` (text[])
- `unstable_concepts` (text[])
- `thinking_style` (text)
- `expression` (text)
- `ai_feedback` (text[])
- `confidence` (numeric)
- `analyzed_at` (timestamp with time zone)

å¯é¸æ¬„ä½ï¼š
- `attempt_id` (uuid, nullable)
- `source` (text, nullable)

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å¦‚æœæ‰€æœ‰æª¢æŸ¥éƒ½é€šéä½†ä»ç„¶å¤±æ•—ï¼Œè«‹æä¾›ï¼š
1. ç€è¦½å™¨æ§åˆ¶å°çš„å®Œæ•´éŒ¯èª¤è¨Šæ¯
2. å¾Œç«¯çµ‚ç«¯çš„å®Œæ•´æ—¥èªŒ
3. `debug-analysis.js` çš„å®Œæ•´è¼¸å‡º

é€™æ¨£æˆ‘å¯ä»¥æ›´ç²¾ç¢ºåœ°å®šä½å•é¡Œï¼
